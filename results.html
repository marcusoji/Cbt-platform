<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Results - CBT Practice</title>
    <link rel="stylesheet" href="public/css/style.css">
    <link rel="stylesheet" href="public/css/cbt-interface.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="/" class="logo">
                    <div class="logo-icon">ðŸ“š</div>
                    <span>CBT Practice</span>
                </a>
                <nav>
                    <ul>
                        <li><a href="dashboard.html" class="btn btn-primary">Back to Dashboard</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <div class="results-container">
        <!-- Score Card -->
        <div class="score-card">
            <h2 style="font-size: 2rem;">Exam Completed! ðŸŽ‰</h2>
            <div class="score-value" id="scoreDisplay">-/%</div>
            <div class="score-label" id="scoreLabel">Excellent Performance!</div>

            <div class="performance-metrics">
                <div class="metric">
                    <div class="metric-value" id="correctAnswers">-</div>
                    <div>Correct</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="wrongAnswers">-</div>
                    <div>Wrong</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="totalQuestions">-</div>
                    <div>Total</div>
                </div>
            </div>
        </div>

        <!-- Detailed Review -->
        <div class="review-section">
            <div class="card-header">
                <h2 class="card-title">Question Review</h2>
                <p style="color: #6b7280;">Review your answers and learn from corrections</p>
            </div>

            <div id="reviewContainer">
                <!-- Questions will be loaded here -->
            </div>
        </div>

        <div style="text-align: center; margin: 2rem 0;">
            <a href="dashboard.html" class="btn btn-primary" style="padding: 1rem 3rem; font-size: 1.1rem;">
                Take Another Exam
            </a>
        </div>
    </div>

    <script>
        function loadResults() {
            const results = JSON.parse(localStorage.getItem('examResults') || '{}');
            
            if (!results.score && results.score !== 0) {
                window.location.href = 'dashboard.html';
                return;
            }

            // Display main score
            const percentage = results.percentage;
            document.getElementById('scoreDisplay').textContent = `${percentage}%`;
            document.getElementById('correctAnswers').textContent = results.score;
            document.getElementById('wrongAnswers').textContent = results.totalQuestions - results.score;
            document.getElementById('totalQuestions').textContent = results.totalQuestions;

            // Score label based on performance
            const scoreLabel = document.getElementById('scoreLabel');
            if (percentage >= 75) {
                scoreLabel.textContent = 'Excellent Performance! ðŸŒŸ';
            } else if (percentage >= 50) {
                scoreLabel.textContent = 'Good Job! Keep Practicing! ðŸ‘';
            } else {
                scoreLabel.textContent = 'Keep Practicing! You Can Do Better! ðŸ’ª';
            }

            // Load detailed review
            const reviewContainer = document.getElementById('reviewContainer');
            reviewContainer.innerHTML = '';

            results.results.forEach((result, index) => {
                const reviewDiv = document.createElement('div');
                reviewDiv.className = 'review-question';

                const statusClass = result.isCorrect ? 'status-correct' : 'status-incorrect';
                const statusText = result.isCorrect ? 'âœ“ Correct' : 'âœ— Incorrect';

                let optionsHTML = '';
                result.options.forEach(option => {
                    let optionClass = '';
                    let optionIcon = '';

                    if (option.label === result.correctAnswer) {
                        optionClass = 'style="color: #059669; font-weight: 600;"';
                        optionIcon = 'âœ“ ';
                    } else if (option.label === result.selectedAnswer && !result.isCorrect) {
                        optionClass = 'style="color: #dc2626; font-weight: 600;"';
                        optionIcon = 'âœ— ';
                    }

                    optionsHTML += `
                        <div ${optionClass} style="margin: 0.5rem 0; padding: 0.5rem;">
                            ${optionIcon}<strong>${option.label}.</strong> ${option.text}
                        </div>
                    `;
                });

                reviewDiv.innerHTML = `
                    <div>
                        <span class="review-status ${statusClass}">${statusText}</span>
                    </div>
                    <h4 style="font-size: 1.1rem; margin: 1rem 0 0.5rem; color: #1f2937;">
                        Question ${index + 1}
                    </h4>
                    <p style="font-size: 1rem; line-height: 1.7; color: #374151; margin-bottom: 1rem;">
                        ${result.questionText}
                    </p>
                    
                    <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        ${optionsHTML}
                    </div>

                    ${!result.isCorrect ? `
                        <div style="background: #fee2e2; padding: 1rem; border-radius: 8px; border-left: 4px solid #dc2626;">
                            <strong style="color: #991b1b;">Your Answer:</strong> 
                            <span style="color: #7f1d1d;">${result.selectedAnswer}</span>
                        </div>
                    ` : ''}

                    <div style="background: #d1fae5; padding: 1rem; border-radius: 8px; margin-top: 0.5rem; border-left: 4px solid #059669;">
                        <strong style="color: #065f46;">Correct Answer:</strong> 
                        <span style="color: #047857;">${result.correctAnswer}</span>
                    </div>

                    ${result.explanation ? `
                        <div style="margin-top: 1rem; padding: 1rem; background: #eff6ff; border-radius: 8px; border-left: 4px solid #2563eb;">
                            <strong style="color: #1e40af;">Explanation:</strong>
                            <p style="color: #1e3a8a; margin-top: 0.5rem;">${result.explanation}</p>
                        </div>
                    ` : ''}
                `;

                reviewContainer.appendChild(reviewDiv);
            });
        }

        loadResults();
    </script>
</body>
</html>